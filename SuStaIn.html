<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Subtype and Stage Inference (SuStaIn) &#8212; Data-Science NA documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Creating synthetic ordinal data" href="synthetic_ordinal_data.html" />
    <link rel="prev" title="Stress prediction based on biometrics data" href="stress_prediction.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Data-Science</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption" role="heading"><span class="caption-text">Linear Analysis Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Bootstrapped_t_test_example.html">Create a bootstrapped t_test function and show it off using the iris data set</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby_apply_ML.html">An example of a use of groupby apply to apply a model to a set of individual groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="Random_walk_on_pink_background.html">Random Walk</a></li>
<li class="toctree-l1"><a class="reference internal" href="uninformative_feature_effect_on_R2.html">Looking at how adding an extra feature with varying levels of relevance effects the r2_score</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Machine Learning Notebooks</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gower_clustering.html">Gower clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="gower_clustering.html#Multiclass-example-1.">Multiclass example 1.</a></li>
<li class="toctree-l1"><a class="reference internal" href="gower_clustering.html#Multiclass-example-2.">Multiclass example 2.</a></li>
<li class="toctree-l1"><a class="reference internal" href="gower_clustering.html#Binary-example">Binary example</a></li>
<li class="toctree-l1"><a class="reference internal" href="ML-workflow.html">Machine Learning Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="stress_prediction.html">Stress prediction based on biometrics data</a></li>
<li class="toctree-l1"><a class="reference internal" href="stress_prediction.html#Read-in-data">Read in data</a></li>
<li class="toctree-l1"><a class="reference internal" href="stress_prediction.html#Exploratory-Data-Analysis-(EDA)">Exploratory Data Analysis (EDA)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Subtype and Stage Inference (SuStaIn)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Prepare-SuStaIn-inputs">Prepare SuStaIn inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Evaluate-subtypes">Evaluate subtypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="#Subtype-and-stage-individuals">Subtype and stage individuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="synthetic_ordinal_data.html">Creating synthetic ordinal data</a></li>
<li class="toctree-l1"><a class="reference internal" href="synthetic_ordinal_data.html#Shuffle-the-target-so-there-are-no-variables-which-have-a-perfect-classification">Shuffle the target so there are no variables which have a perfect classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="understanding_SHAP.html">Using a toy dataset to better understand SHapley Additive exPlanations (SHAP)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">NLTSA Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="1st_2nd_order_ODE.html">first order and second order ordinary differential equations (ODE)s</a></li>
<li class="toctree-l1"><a class="reference internal" href="1st_2nd_order_ODE.html#1st-order-ODE">1st order ODE</a></li>
<li class="toctree-l1"><a class="reference internal" href="1st_2nd_order_ODE.html#2nd-order-ODE">2nd order ODE</a></li>
<li class="toctree-l1"><a class="reference internal" href="facs_test_CRDs.html">Methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="facs_test_CRDs.html#Plot-all-of-the-time-series-levels-of-the-FACS">Plot all of the time series levels of the FACS</a></li>
<li class="toctree-l1"><a class="reference internal" href="fatigue_change_over_time.html">Methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="scikit-identification-example.html">scikit-identification Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="seizure_patterns.html">Looking for patterns in grand mal seizures</a></li>
<li class="toctree-l1"><a class="reference internal" href="seizure_patterns.html#Context">Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="seizure_patterns.html#About-Tubular-Sclerosis">About Tubular Sclerosis</a></li>
<li class="toctree-l1"><a class="reference internal" href="smoothing_options.html">Testing out rolling smoothing functions</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Subtype and Stage Inference (SuStaIn)</a><ul>
<li><a class="reference internal" href="#Look-at-what-the-data-looks-like">Look at what the data looks like</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Prepare-SuStaIn-inputs">Prepare SuStaIn inputs</a></li>
<li><a class="reference internal" href="#Evaluate-subtypes">Evaluate subtypes</a></li>
<li><a class="reference internal" href="#Subtype-and-stage-individuals">Subtype and stage individuals</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Subtype-and-Stage-Inference-(SuStaIn)">
<h1>Subtype and Stage Inference (SuStaIn)<a class="headerlink" href="#Subtype-and-Stage-Inference-(SuStaIn)" title="Permalink to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[145]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pySuStaIn</span> <span class="k">as</span> <span class="nn">ps</span>
<span class="kn">from</span> <span class="nn">jmspack.utils</span> <span class="kn">import</span> <span class="n">apply_scaling</span>
<span class="kn">from</span> <span class="nn">jmspack.ml_utils</span> <span class="kn">import</span> <span class="n">plot_confusion_matrix</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[149]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">roc_curve</span><span class="p">,</span> <span class="n">auc</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">SuStaIn_extras.simfuncs</span> <span class="kn">import</span> <span class="n">generate_random_Zscore_sustain_model</span><span class="p">,</span> <span class="n">generate_data_Zscore_sustain</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;jms_style_sheet&quot;</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">available</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;jms_style_sheet&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Look-at-what-the-data-looks-like">
<h2>Look at what the data looks like<a class="headerlink" href="#Look-at-what-the-data-looks-like" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/ucl-pond/pySuStaIn/master/notebooks/SimulatedData.csv&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RID</th>
      <th>Diagnosis</th>
      <th>Age</th>
      <th>Headsize</th>
      <th>Biomarker1</th>
      <th>Biomarker2</th>
      <th>Biomarker3</th>
      <th>Biomarker4</th>
      <th>Biomarker5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>63.501953</td>
      <td>0.920706</td>
      <td>132.511729</td>
      <td>180.698267</td>
      <td>120.119201</td>
      <td>159.200991</td>
      <td>190.197486</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>61.240101</td>
      <td>0.952784</td>
      <td>154.500427</td>
      <td>194.299318</td>
      <td>179.148420</td>
      <td>173.515194</td>
      <td>237.807726</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>52.108876</td>
      <td>1.061493</td>
      <td>140.878957</td>
      <td>170.449488</td>
      <td>160.945261</td>
      <td>163.988839</td>
      <td>207.271331</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>65.989165</td>
      <td>0.871652</td>
      <td>146.361556</td>
      <td>175.111234</td>
      <td>164.769410</td>
      <td>114.437784</td>
      <td>184.657121</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>65.071640</td>
      <td>1.147264</td>
      <td>167.254806</td>
      <td>203.470447</td>
      <td>232.783278</td>
      <td>212.857075</td>
      <td>245.588402</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;RID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_7_0.png" src="_images/SuStaIn_7_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span>
                <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;RID&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">apply_scaling</span><span class="p">)</span>
                <span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_8_0.png" src="_images/SuStaIn_8_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span>
                <span class="c1"># .set_index(&quot;RID&quot;)</span>
                <span class="c1"># .pipe(apply_scaling)</span>
                <span class="c1"># .reset_index()</span>
                <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Headsize&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">])</span>
                <span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_9_0.png" src="_images/SuStaIn_9_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span>
                <span class="c1"># .set_index(&quot;RID&quot;)</span>
                <span class="c1"># .pipe(apply_scaling)</span>
                <span class="c1"># .reset_index()</span>
                <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Headsize&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">])</span>
                <span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_10_0.png" src="_images/SuStaIn_10_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[144]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span> <span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="s2">&quot;Headsize&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_11_0.png" src="_images/SuStaIn_11_0.png" />
</div>
</div>
</section>
</section>
<section id="Prepare-SuStaIn-inputs">
<h1>Prepare SuStaIn inputs<a class="headerlink" href="#Prepare-SuStaIn-inputs" title="Permalink to this heading">¶</a></h1>
<p>Now that we’ve z-scored our data, let’s start prepping the many SuStaIn inputs</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zdata</span><span class="o">=</span><span class="p">(</span><span class="n">data</span>
       <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span> <span class="s2">&quot;Diagnosis&quot;</span><span class="p">])</span>
       <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">apply_scaling</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Standard&quot;</span><span class="p">)</span>
       <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
       <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Biomarker_list</span><span class="o">=</span><span class="n">zdata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;Biom&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Biomarker_list</span><span class="p">)</span>         <span class="c1"># number of biomarkers</span>

<span class="n">SuStaInLabels</span> <span class="o">=</span> <span class="n">Biomarker_list</span>
<span class="n">Z_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>     <span class="c1"># Z-scores for each biomarker</span>
<span class="n">Z_max</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>           <span class="c1"># maximum z-score</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Z_vals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[1 2 3]
 [1 2 3]
 [1 2 3]
 [1 2 3]
 [1 2 3]]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input the settings for z-score SuStaIn</span>
<span class="c1"># To make the tutorial run faster I&#39;ve set</span>
<span class="c1"># N_startpoints = 10 and N_iterations_MCMC = int(1e4)</span>
<span class="c1"># I recommend using N_startpoints = 25 and</span>
<span class="c1"># N_iterations_MCMC = int(1e5) or int(1e6) in general though</span>

<span class="n">N_startpoints</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">N_S_max</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">N_iterations_MCMC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">)</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;SuStaIn_example_output&#39;</span><span class="p">)</span>
<span class="n">dataset_name</span> <span class="o">=</span> <span class="s1">&#39;SuStaIn_example_output&#39;</span>

<span class="c1"># Initiate the SuStaIn object</span>
<span class="n">sustain_input</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">ZscoreSustain</span><span class="p">(</span>
                              <span class="n">zdata</span><span class="p">[</span><span class="n">Biomarker_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                              <span class="n">Z_vals</span><span class="p">,</span>
                              <span class="n">Z_max</span><span class="p">,</span>
                              <span class="n">SuStaInLabels</span><span class="p">,</span>
                              <span class="n">N_startpoints</span><span class="p">,</span>
                              <span class="n">N_S_max</span><span class="p">,</span>
                              <span class="n">N_iterations_MCMC</span><span class="p">,</span>
                              <span class="n">output_folder</span><span class="p">,</span>
                              <span class="n">dataset_name</span><span class="p">,</span>
                              <span class="kc">False</span><span class="p">)</span>

<span class="c1"># make the output directory if it&#39;s not already created</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[116]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">samples_sequence</span><span class="p">,</span>
<span class="n">samples_f</span><span class="p">,</span>
<span class="n">ml_subtype</span><span class="p">,</span>
<span class="n">prob_ml_subtype</span><span class="p">,</span>
<span class="n">ml_stage</span><span class="p">,</span>
<span class="n">prob_ml_stage</span><span class="p">,</span>
<span class="n">prob_subtype_stage</span><span class="p">)</span>  <span class="o">=</span> <span class="n">sustain_input</span><span class="o">.</span><span class="n">run_sustain_algorithm</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Found pickle file: /Users/jamestwose/Coding/Data-Science/Machine_learning/SuStaIn_example_output/pickle_files/SuStaIn_example_output_subtype0.pickle. Using pickled variables for 0 subtype.
Found pickle file: /Users/jamestwose/Coding/Data-Science/Machine_learning/SuStaIn_example_output/pickle_files/SuStaIn_example_output_subtype1.pickle. Using pickled variables for 1 subtype.
Found pickle file: /Users/jamestwose/Coding/Data-Science/Machine_learning/SuStaIn_example_output/pickle_files/SuStaIn_example_output_subtype2.pickle. Using pickled variables for 2 subtype.
</pre></div></div>
</div>
</section>
<section id="Evaluate-subtypes">
<h1>Evaluate subtypes<a class="headerlink" href="#Evaluate-subtypes" title="Permalink to this heading">¶</a></h1>
<p>Here, we’ll plot the log likelihood across MCMC samples, across each subtype. This will give us at least a basic sense of what how many subtypes we should consider looking at</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[117]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_LL_df</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="n">column_name</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">column_name</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[118]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LL_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">read_LL_df</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_folder</span><span class="si">}</span><span class="s2">/pickle_files/</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">_subtype</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">,</span>
                      <span class="n">column_name</span><span class="o">=</span><span class="s2">&quot;samples_likelihood&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_S_max</span><span class="p">)],</span>
          <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">LL_df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Log Likelihood </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_S_max</span><span class="p">)]</span>

<span class="n">LL_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[118]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Log Likelihood 0</th>
      <th>Log Likelihood 1</th>
      <th>Log Likelihood 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-3126.082292</td>
      <td>-3126.366677</td>
      <td>-3128.886094</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-3126.082292</td>
      <td>-3126.366677</td>
      <td>-3129.403164</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-3126.082292</td>
      <td>-3126.366677</td>
      <td>-3129.431895</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-3126.082292</td>
      <td>-3126.368944</td>
      <td>-3129.156358</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-3126.082292</td>
      <td>-3126.494339</td>
      <td>-3129.156358</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[119]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">LL_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
                 <span class="n">x</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span>
                 <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
                 <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;MCMC samples&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Log likelihood&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;MCMC trace&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">LL_df</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Log likelihood&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of samples&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histograms of model likelihood&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_23_0.png" src="_images/SuStaIn_23_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_23_1.png" src="_images/SuStaIn_23_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[120]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s plot positional variance diagrams to interpret the subtype progressions</span>

<span class="n">s</span> <span class="o">=</span> <span class="mi">1</span><span class="c1"># 1 split = 2 subtypes</span>
<span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zdata</span><span class="p">[</span><span class="n">Biomarker_list</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># get the sample sequences and f</span>
<span class="n">pickle_filename_s</span> <span class="o">=</span> <span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;/pickle_files/&#39;</span> <span class="o">+</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="s1">&#39;_subtype&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span>
<span class="n">pk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">pickle_filename_s</span><span class="p">)</span>
<span class="n">samples_sequence</span> <span class="o">=</span> <span class="n">pk</span><span class="p">[</span><span class="s2">&quot;samples_sequence&quot;</span><span class="p">]</span>
<span class="n">samples_f</span> <span class="o">=</span> <span class="n">pk</span><span class="p">[</span><span class="s2">&quot;samples_f&quot;</span><span class="p">]</span>

<span class="c1"># use this information to plot the positional variance diagrams</span>
<span class="n">tmp</span><span class="o">=</span><span class="n">ps</span><span class="o">.</span><span class="n">ZscoreSustain</span><span class="o">.</span><span class="n">_plot_sustain_model</span><span class="p">(</span><span class="n">sustain_input</span><span class="p">,</span><span class="n">samples_sequence</span><span class="p">,</span><span class="n">samples_f</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">subtype_order</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_24_0.png" src="_images/SuStaIn_24_0.png" />
</div>
</div>
</section>
<section id="Subtype-and-stage-individuals">
<h1>Subtype and stage individuals<a class="headerlink" href="#Subtype-and-stage-individuals" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[121]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s take a look at all of the things that exist in SuStaIn&#39;s output (pickle) file</span>
<span class="n">pk</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[121]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;samples_sequence&#39;, &#39;samples_f&#39;, &#39;samples_likelihood&#39;, &#39;ml_subtype&#39;, &#39;prob_ml_subtype&#39;, &#39;ml_stage&#39;, &#39;prob_ml_stage&#39;, &#39;prob_subtype&#39;, &#39;prob_stage&#39;, &#39;prob_subtype_stage&#39;, &#39;ml_sequence_EM&#39;, &#39;ml_sequence_prev_EM&#39;, &#39;ml_f_EM&#39;, &#39;ml_f_prev_EM&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[122]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The SuStaIn output has everything we need. We&#39;ll use it to populate our dataframe.</span>

<span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pickle_filename_s</span> <span class="o">=</span> <span class="n">output_folder</span> <span class="o">+</span> <span class="s1">&#39;/pickle_files/&#39;</span> <span class="o">+</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="s1">&#39;_subtype&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pickle&#39;</span>
<span class="n">pk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">pickle_filename_s</span><span class="p">)</span>

<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ml_subtype&#39;</span><span class="p">,</span> <span class="c1"># the assigned subtype</span>
                 <span class="s1">&#39;prob_ml_subtype&#39;</span><span class="p">,</span> <span class="c1"># the probability of the assigned subtype</span>
                 <span class="s1">&#39;ml_stage&#39;</span><span class="p">,</span> <span class="c1"># the assigned stage</span>
                 <span class="s1">&#39;prob_ml_stage&#39;</span><span class="p">,]:</span> <span class="c1"># the probability of the assigned stage</span>

    <span class="c1"># add SuStaIn output to dataframe</span>
    <span class="n">zdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">pk</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>

<span class="c1"># let&#39;s also add the probability for each subject of being each subtype</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">zdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;prob_S</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = pk[&#39;prob_subtype&#39;][:,i]
<span class="n">zdata</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[122]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RID</th>
      <th>Diagnosis</th>
      <th>Age</th>
      <th>Headsize</th>
      <th>Biomarker1</th>
      <th>Biomarker2</th>
      <th>Biomarker3</th>
      <th>Biomarker4</th>
      <th>Biomarker5</th>
      <th>ml_subtype</th>
      <th>prob_ml_subtype</th>
      <th>ml_stage</th>
      <th>prob_ml_stage</th>
      <th>prob_S0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>-0.276180</td>
      <td>-0.787699</td>
      <td>-0.830888</td>
      <td>-0.535437</td>
      <td>-0.780946</td>
      <td>-0.007298</td>
      <td>-0.066520</td>
      <td>0.0</td>
      <td>0.988207</td>
      <td>0.0</td>
      <td>0.172095</td>
      <td>0.988207</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>-0.740595</td>
      <td>-0.476933</td>
      <td>0.283935</td>
      <td>0.399624</td>
      <td>0.519579</td>
      <td>0.360694</td>
      <td>1.500778</td>
      <td>0.0</td>
      <td>0.988605</td>
      <td>1.0</td>
      <td>0.131844</td>
      <td>0.988605</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>-2.615462</td>
      <td>0.576247</td>
      <td>-0.406671</td>
      <td>-1.240033</td>
      <td>0.118529</td>
      <td>0.115789</td>
      <td>0.495540</td>
      <td>0.0</td>
      <td>0.988028</td>
      <td>0.0</td>
      <td>0.151258</td>
      <td>0.988028</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>0.234506</td>
      <td>-1.262940</td>
      <td>-0.128704</td>
      <td>-0.919541</td>
      <td>0.202783</td>
      <td>-1.158080</td>
      <td>-0.248905</td>
      <td>0.0</td>
      <td>0.988692</td>
      <td>0.0</td>
      <td>0.170236</td>
      <td>0.988692</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>0.046116</td>
      <td>1.407189</td>
      <td>0.930579</td>
      <td>1.030132</td>
      <td>1.701257</td>
      <td>1.372103</td>
      <td>1.756912</td>
      <td>0.0</td>
      <td>0.989070</td>
      <td>2.0</td>
      <td>0.123890</td>
      <td>0.989070</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[123]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IMPORTANT!!! The last thing we need to do is to set all &quot;Stage 0&quot; subtypes to their own subtype</span>
<span class="c1"># We&#39;ll set current subtype (0 and 1) to 1 and 0, and we&#39;ll call &quot;Stage 0&quot; individuals subtype 0.</span>

<span class="c1"># make current subtypes (0 and 1) 1 and 2 instead</span>
<span class="n">zdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ml_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zdata</span><span class="o">.</span><span class="n">ml_subtype</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># convert &quot;Stage 0&quot; subjects to subtype 0</span>
<span class="n">zdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">zdata</span><span class="o">.</span><span class="n">ml_stage</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ml_subtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[124]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zdata</span><span class="o">.</span><span class="n">ml_subtype</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[124]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.0    277
1.0    223
Name: ml_subtype, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[125]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;ml_stage&#39;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;Diagnosis&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">zdata</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;ml_subtype&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_30_0.png" src="_images/SuStaIn_30_0.png" />
</div>
</div>
<p>One might want to view whether there are relationships between SuStaIn subtype and stage and other variables.</p>
<p>This step should probably be done after you run cross-validation (see below), but we’ll do it here first to keep up the momentum</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[132]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting relationship between a biomarker and SuStaIn stage across subtypes</span>

<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;Biomarker3&#39;</span>

<span class="c1"># plot relationship</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;ml_stage&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ml_subtype&#39;</span><span class="p">,</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">zdata</span><span class="p">,</span>
           <span class="c1">#lowess=True # uncomment if you would prefer a lowess curve to a linear curve</span>
          <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_33_0.png" src="_images/SuStaIn_33_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[134]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot an example variable:</span>

<span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;Biomarker3&#39;</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;ml_subtype&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">zdata</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_34_0.png" src="_images/SuStaIn_34_0.png" />
</div>
</div>
<p>Finally, it is often difficult to decide how many subtypes best fit your data. This question should ideally be evaluated using cross-validation. This way, the likelihood metrics are generated for data that the model has not yet seen.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[136]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># choose the number of folds - here i&#39;ve used three for speed but i recommend 10 typically</span>
<span class="n">N_folds</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># generate stratified cross-validation training and test set splits</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">zdata</span><span class="o">.</span><span class="n">Diagnosis</span><span class="o">.</span><span class="n">values</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">N_folds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cv_it</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">zdata</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

<span class="c1"># SuStaIn currently accepts ragged arrays, which will raise problems in the future.</span>
<span class="c1"># We&#39;ll have to update this in the future, but this will have to do for now</span>
<span class="n">test_idxs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">cv_it</span><span class="p">:</span>
    <span class="n">test_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">test_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_idxs</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># perform cross-validation and output the cross-validation information criterion and</span>
<span class="c1"># log-likelihood on the test set for each subtypes model and fold combination</span>
<span class="n">CVIC</span><span class="p">,</span> <span class="n">loglike_matrix</span>     <span class="o">=</span> <span class="n">sustain_input</span><span class="o">.</span><span class="n">cross_validate_sustain_model</span><span class="p">(</span><span class="n">test_idxs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Folds:   0%|          | 0/3 [00:00&lt;?, ?it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Finding ML solution to 1 cluster problem
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overall ML likelihood is -2925.8514615643726
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:07&lt;00:00, 1374.51it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:07&lt;00:00, 1408.69it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:07&lt;00:00, 1412.94it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1466.51it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Splitting cluster 1 of 1
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- ML likelihood is [-2915.83620169]
Overall ML likelihood is [-2915.83620169]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 723.63it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:14&lt;00:00, 702.21it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:14&lt;00:00, 683.84it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 744.67it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Splitting cluster 1 of 2
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
- ML likelihood is [-2916.87084341]
Splitting cluster 2 of 2
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- ML likelihood is [-2915.70811384]
Overall ML likelihood is [-2915.70811384]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 515.22it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 518.04it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 514.56it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 518.56it/s]
Folds:  33%|███▎      | 1/3 [05:54&lt;11:49, 354.95s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Finding ML solution to 1 cluster problem
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overall ML likelihood is -2909.1942345900197
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1461.96it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1458.31it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1460.03it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1459.00it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Splitting cluster 1 of 1
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- ML likelihood is [-2897.58739115]
Overall ML likelihood is [-2897.58739115]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 740.61it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 736.16it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 737.21it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 740.12it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Splitting cluster 1 of 2
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
- ML likelihood is [-2896.94827952]
Splitting cluster 2 of 2
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- ML likelihood is [-2896.98015664]
Overall ML likelihood is [-2896.94827952]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 518.96it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 519.56it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 516.69it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 522.66it/s]
Folds:  67%|██████▋   | 2/3 [10:54&lt;05:38, 338.48s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Finding ML solution to 1 cluster problem
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overall ML likelihood is -2938.565036910918
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1459.83it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1469.35it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1466.39it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:06&lt;00:00, 1467.66it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Splitting cluster 1 of 1
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- ML likelihood is [-2921.99112889]
Overall ML likelihood is [-2921.99112889]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 743.32it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 742.27it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:13&lt;00:00, 723.66it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:14&lt;00:00, 697.76it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Splitting cluster 1 of 2
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
- ML likelihood is [-2921.87370898]
Splitting cluster 2 of 2
 + Resolving 2 cluster problem
 + Finding ML solution from hierarchical initialisation
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
- ML likelihood is [-2921.98932582]
Overall ML likelihood is [-2921.87370898]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
MCMC Iteration: 100%|██████████| 10000/10000 [00:20&lt;00:00, 486.90it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:20&lt;00:00, 494.25it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 510.56it/s]
MCMC Iteration: 100%|██████████| 10000/10000 [00:19&lt;00:00, 511.48it/s]
Folds: 100%|██████████| 3/3 [16:29&lt;00:00, 329.69s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Average test set log-likelihood for each subtype model: [-1464.8471909  -1463.34146558 -1464.57061661]
CVIC for each subtype model: [8771.76906239 8767.96679457 8776.06721456]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>The optimal number of subtypes is chosen using the CVIC, shown below. The CVIC is an information criterion (like the AIC/BIC/WAIC) that balances model complexity with model accuracy, with a lower CVIC indicating a better balance between the two. Generally speaking, the model with the lowest CVIC is the best. However, you do sometimes get a very small improvement (less than ~6) in the CVIC with a more complex model, in which case I would tend to favour the less complex (i.e. fewer subtypes)
model.</p>
<p>Another useful metric to look at is the log-likelihood of each subtypes model on the test set, also shown below. A better model should show a consistent improvement in the test set log-likelihood across folds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[138]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># go through each subtypes model and plot the log-likelihood on the test set and the CVIC</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CVIC for each subtype model: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CVIC</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average test set log-likelihood for each subtype model: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">loglike_matrix</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N_S_max</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span><span class="n">CVIC</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N_S_max</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CVIC&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Subtypes model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CVIC&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_loglike</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">loglike_matrix</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;s_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sustain_input</span><span class="o">.</span><span class="n">N_S_max</span><span class="p">)])</span>
<span class="n">df_loglike</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Log likelihood&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Subtypes model&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Test set log-likelihood across folds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CVIC for each subtype model: [8771.76906239 8767.96679457 8776.06721456]
Average test set log-likelihood for each subtype model: [-1464.8471909  -1463.34146558 -1464.57061661]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_40_1.png" src="_images/SuStaIn_40_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_40_2.png" src="_images/SuStaIn_40_2.png" />
</div>
</div>
<p>Another useful output of the cross-validation that you can look at are positional variance diagrams averaged across cross-validation folds. These give you an idea of the variability in the progression patterns across different training datasets.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[139]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this part estimates cross-validated positional variance diagrams</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_S_max</span><span class="p">):</span>
    <span class="n">sustain_input</span><span class="o">.</span><span class="n">combine_cross_validated_sequences</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_folds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/miniconda3/envs/ds_env/lib/python3.8/site-packages/pySuStaIn/ZscoreSustain.py:505: UserWarning: Both labels and an order have been given. The labels will be reordered according to the given order!
  warnings.warn(
/opt/miniconda3/envs/ds_env/lib/python3.8/site-packages/pySuStaIn/AbstractSustain.py:522: UserWarning: Matplotlib is currently using module://ipykernel.pylab.backend_inline, which is a non-GUI backend, so cannot show the figure.
  fig.show()
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_42_1.png" src="_images/SuStaIn_42_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_42_2.png" src="_images/SuStaIn_42_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_42_3.png" src="_images/SuStaIn_42_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[141]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N_S_selected</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">ps</span><span class="o">.</span><span class="n">ZscoreSustain</span><span class="o">.</span><span class="n">_plot_sustain_model</span><span class="p">(</span><span class="n">sustain_input</span><span class="p">,</span><span class="n">samples_sequence</span><span class="p">,</span><span class="n">samples_f</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">subtype_order</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;SuStaIn output&#39;</span><span class="p">)</span>

<span class="n">sustain_input</span><span class="o">.</span><span class="n">combine_cross_validated_sequences</span><span class="p">(</span><span class="n">N_S_selected</span><span class="p">,</span> <span class="n">N_folds</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Cross-validated SuStaIn output&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/opt/miniconda3/envs/ds_env/lib/python3.8/site-packages/pySuStaIn/ZscoreSustain.py:505: UserWarning: Both labels and an order have been given. The labels will be reordered according to the given order!
  warnings.warn(
/opt/miniconda3/envs/ds_env/lib/python3.8/site-packages/pySuStaIn/AbstractSustain.py:522: UserWarning: Matplotlib is currently using module://ipykernel.pylab.backend_inline, which is a non-GUI backend, so cannot show the figure.
  fig.show()
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_43_1.png" src="_images/SuStaIn_43_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_43_2.png" src="_images/SuStaIn_43_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zdata</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RID</th>
      <th>Diagnosis</th>
      <th>Age</th>
      <th>Headsize</th>
      <th>Biomarker1</th>
      <th>Biomarker2</th>
      <th>Biomarker3</th>
      <th>Biomarker4</th>
      <th>Biomarker5</th>
      <th>ml_subtype</th>
      <th>prob_ml_subtype</th>
      <th>ml_stage</th>
      <th>prob_ml_stage</th>
      <th>prob_S0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>-0.276180</td>
      <td>-0.787699</td>
      <td>-0.830888</td>
      <td>-0.535437</td>
      <td>-0.780946</td>
      <td>-0.007298</td>
      <td>-0.066520</td>
      <td>0.0</td>
      <td>0.988207</td>
      <td>0.0</td>
      <td>0.172095</td>
      <td>0.988207</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>-0.740595</td>
      <td>-0.476933</td>
      <td>0.283935</td>
      <td>0.399624</td>
      <td>0.519579</td>
      <td>0.360694</td>
      <td>1.500778</td>
      <td>1.0</td>
      <td>0.988605</td>
      <td>1.0</td>
      <td>0.131844</td>
      <td>0.988605</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>-2.615462</td>
      <td>0.576247</td>
      <td>-0.406671</td>
      <td>-1.240033</td>
      <td>0.118529</td>
      <td>0.115789</td>
      <td>0.495540</td>
      <td>0.0</td>
      <td>0.988028</td>
      <td>0.0</td>
      <td>0.151258</td>
      <td>0.988028</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1</td>
      <td>0.234506</td>
      <td>-1.262940</td>
      <td>-0.128704</td>
      <td>-0.919541</td>
      <td>0.202783</td>
      <td>-1.158080</td>
      <td>-0.248905</td>
      <td>0.0</td>
      <td>0.988692</td>
      <td>0.0</td>
      <td>0.170236</td>
      <td>0.988692</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1</td>
      <td>0.046116</td>
      <td>1.407189</td>
      <td>0.930579</td>
      <td>1.030132</td>
      <td>1.701257</td>
      <td>1.372103</td>
      <td>1.756912</td>
      <td>1.0</td>
      <td>0.989070</td>
      <td>2.0</td>
      <td>0.123890</td>
      <td>0.989070</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>495</th>
      <td>496</td>
      <td>1</td>
      <td>1.119906</td>
      <td>0.571858</td>
      <td>1.122096</td>
      <td>1.340379</td>
      <td>0.321798</td>
      <td>0.470860</td>
      <td>2.604667</td>
      <td>1.0</td>
      <td>0.988569</td>
      <td>1.0</td>
      <td>0.119868</td>
      <td>0.988569</td>
    </tr>
    <tr>
      <th>496</th>
      <td>497</td>
      <td>1</td>
      <td>-0.246835</td>
      <td>0.389960</td>
      <td>-0.302929</td>
      <td>-0.486702</td>
      <td>-0.296574</td>
      <td>-0.340193</td>
      <td>0.579880</td>
      <td>0.0</td>
      <td>0.988292</td>
      <td>0.0</td>
      <td>0.154557</td>
      <td>0.988292</td>
    </tr>
    <tr>
      <th>497</th>
      <td>498</td>
      <td>1</td>
      <td>0.524801</td>
      <td>1.685751</td>
      <td>0.467129</td>
      <td>0.267638</td>
      <td>-0.056103</td>
      <td>-0.649472</td>
      <td>1.179206</td>
      <td>1.0</td>
      <td>0.988619</td>
      <td>1.0</td>
      <td>0.139940</td>
      <td>0.988619</td>
    </tr>
    <tr>
      <th>498</th>
      <td>499</td>
      <td>1</td>
      <td>-1.150475</td>
      <td>-0.465810</td>
      <td>0.588425</td>
      <td>-1.742670</td>
      <td>0.862520</td>
      <td>0.328767</td>
      <td>-1.432088</td>
      <td>0.0</td>
      <td>0.988712</td>
      <td>0.0</td>
      <td>0.155753</td>
      <td>0.988712</td>
    </tr>
    <tr>
      <th>499</th>
      <td>500</td>
      <td>1</td>
      <td>-0.678464</td>
      <td>1.854392</td>
      <td>-1.067955</td>
      <td>-0.197901</td>
      <td>0.137157</td>
      <td>-0.330619</td>
      <td>-0.499497</td>
      <td>0.0</td>
      <td>0.988864</td>
      <td>0.0</td>
      <td>0.169796</td>
      <td>0.988864</td>
    </tr>
  </tbody>
</table>
<p>500 rows × 14 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[148]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">zdata</span><span class="p">[</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">],</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">zdata</span><span class="p">[</span><span class="s2">&quot;ml_subtype&quot;</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">cf</span><span class="o">=</span><span class="n">cf_matrix</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Confusion Matrix classifying Diagnosis&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_45_0.png" src="_images/SuStaIn_45_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[153]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="o">=</span><span class="n">zdata</span><span class="p">[</span><span class="s2">&quot;Diagnosis&quot;</span><span class="p">],</span> <span class="n">y_score</span><span class="o">=</span><span class="n">zdata</span><span class="p">[</span><span class="s2">&quot;ml_subtype&quot;</span><span class="p">],</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop_intermediate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">auc_score</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span><span class="n">tpr</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean AUC: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">auc_score</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ROC curve SuStaIn - Diagnosis classification&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/SuStaIn_46_0.png" src="_images/SuStaIn_46_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/SuStaIn.nblink.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2022, James Twose.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>